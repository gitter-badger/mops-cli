#!/usr/bin/env node --harmony

'use strict';

var program = require('commander');

var MopsConfig = require('../lib/util/MopsConfig');
var promptUtil = require('../lib/util/promptUtil');

var HOST_DESCRIPTION = 'Public API Endpoint (hostname:port)';
var USER_DESCRIPTION = 'Username/Email';
var API_KEY_DESCRIPTION = 'API Key';

program
  .option('-h, --host [host]', HOST_DESCRIPTION)
  .option('-u, --user [username]', USER_DESCRIPTION)
  .option('-a, --apiKey [apiKey]', API_KEY_DESCRIPTION)
  .parse(process.argv);

promptUtil.getRequiredOptions({
    properties: {
        host: {
            default: 'cloud.mongodb.com',
            message: HOST_DESCRIPTION,
            required: true
        },
        user: {
            message: USER_DESCRIPTION,
            required: true
        },
        apiKey: {
            message: API_KEY_DESCRIPTION,
            required: true,
            hidden: true
        }
    }
}, program).then(function(options) {
    login(options);
}).fail(function(err) {
    console.error('Unable to retrieve required options', err);
});

function login(options) {
    var config = new MopsConfig();
    config.set('host', options.host);
    config.set('user', options.user);
    config.set('apiKey', options.apiKey);
    config.save();
}
